webpackJsonp([27],{"X/JS":function(t,s){},dZvN:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i={name:"mjsactivity",data:function(){return{selected:[{is_selected:1},{is_selected:0},{is_selected:0}],priceImg:!1,priceSort:!1,types:"",prciDeep:"",promId:this.$route.query.prom_id,goodslist:[],Titles:"",activitydate:"",curPage:1,allPage:"",orderPage:"",loading:!1,loadBottom:!1,notMore:!1,promTitle:"",promType:"",popupVisible:!1,goodsName:"",goodsPrice:"",storeCount:"",shopYPrice:"",goodsSpec:"",arr:[],arr1:[],arr2:[],arr3:[],Stringa:[],dialogimg:"",specgrouplist:[],buyNum:1,goodsIdarr:[],goodsNumarr:[],goodsSpecarr:[],haveSpec:!1,showAddShopping:!0,showGoShopping:!0,empty:!1}},beforeMount:function(){this.promId=this.$route.query.prom_id,this.promType=this.$route.query.prom_type,document.title=this.$route.meta.title},mounted:function(){this.getinfo()},methods:{sortType:function(t){this.types=t;for(var s=0;s<this.selected.length;s++)this.selected[s].is_selected=0;""==t&&(this.selected[0].is_selected=1),"sales_sum"==t&&(this.selected[1].is_selected=1),"price"==t&&(this.selected[2].is_selected=1),"price"==t?(this.priceImg=!0,this.priceSort=!this.priceSort):this.priceImg=!1,this.priceSort?this.prciDeep="desc":this.prciDeep="asc",""==t&&(this.prciDeep=""),"sales_sum"==t&&(this.prciDeep="desc"),this.curPage=1,this.goodslist=[],this.getinfo()},getinfo:function(){var t=this;t.$axios({method:"get",url:t.$store.state.api.mjs.getAlist,params:{prom_id:t.promId,page:t.curPage,page_count:10,sort:t.types,sort_asc:t.prciDeep}}).then(function(s){0==s.data.error&&(t.promTitle=s.data.data.prom_data.title,t.goodslist=t.goodslist.concat(s.data.data.list),t.Titles=s.data.data.prom_data.title,t.activitydate=s.data.data.prom_data,t.orderPage=s.data.data.pagination.page_total,t.goodslist.length?t.empty=!1:t.empty=!0,1==t.curPage&&t.$nextTick(function(){window.scrollTo(0,1),window.scrollTo(0,0)}))})},loadMore:function(){var t=this;if(t.curPage>=t.orderPage)return t.loadBottom=!1,void(t.notMore=!0);t.loadBottom=!0,t.notMore=!1,t.loading=!0,setTimeout(function(){t.loading=!1,t.curPage<t.orderPage&&(t.curPage++,t.getinfo())},250)},close:function(){this.buyNum=1,this.popupVisible=!1},getspecs:function(t){var s=this;s.$axios({method:"get",url:s.$store.state.api.mjs.getspec,params:{goods_id:t.goods_id}}).then(function(e){0==e.data.error&&(s.goodsName=t.goods_name,s.dialogimg=t.image,s.goodsPrice=t.price,s.goodsIdarr=t.goods_id,s.specgrouplist=e.data.data.spec,s.scalaPrice=e.data.data.spec_keys,1==s.specgrouplist.length&&1==s.specgrouplist[0].items.length?(s.goodsSpec=s.specgrouplist[0].items[0].item,s.Stringa=s.specgrouplist[0].items[0].item_id,s.storeCount=s.scalaPrice[s.Stringa].store_count,s.haveSpec=!1):s.haveSpec=!0,s.popupVisible=!0)})},getItemsId:function(t,s,e){this.arr3=[];for(var i=0;i<this.specgrouplist[e].items.length;i++)this.specgrouplist[e].items[i].select=0;if(t.select=1,this.specgrouplist[e].items.length>1){var o=new Object;for(var a in o.index=e,o.id=t.item_id,this.arr1.push(o),this.arr1)for(var r in this.arr1)a<r&&this.arr1[a].index==this.arr1[r].index&&this.arr1.splice(a,1)}if(1==this.specgrouplist[e].items.length){var c=new Object;c.index=e,c.id=t.item_id,this.arr2.push(c)}for(var n in this.arr=this.arr1.concat(this.arr2),this.arr)this.arr3.push(this.arr[n].id);for(var d=0;d<this.arr3.length-1;d++)for(var p=d+1;p<this.arr3.length;p++){var l=this.arr3[d];if(l>this.arr3[p]){var u=this.arr3[p];this.arr3[p]=l,this.arr3[d]=u}}var h=[];for(d=0,p=this.arr3.length;d<p;d++)-1===h.indexOf(this.arr3[d])&&h.push(this.arr3[d]);this.arr3=h,this.arr3.length==this.specgrouplist.length&&this.sortReSt(),this.goodsSpecarr=[],this.goodsSpecarr.push(this.Stringa)},sortReSt:function(){if(0==this.Stringa.length&&(this.Stringa=this.arr3[0]),(this.Stringa=this.arr3[0])&&(this.Stringa=this.arr3.join("_")),this.arr3.length==this.specgrouplist.length)for(var t in this.scalaPrice)if(this.Stringa==t)return this.goodsPrice=this.scalaPrice[t].price,this.storeCount=this.scalaPrice[t].store_count,void(this.shopYPrice=this.scalaPrice[t].market_price)},addCount:function(){this.buyNum>=this.storeCount||(this.buyNum=parseInt(this.buyNum)+1,this.goodsNumarr=[],this.goodsNumarr.push(this.buyNum))},miusCount:function(){this.buyNum>1?(this.buyNum--,this.goodsNumarr=[],this.goodsNumarr.push(this.buyNum)):this.buyNum=1},addorgoShopping:function(t){var s=this;t=t;s.$axios.post(s.$store.state.api.goodsDetail.addCart,{goods_id:s.goodsIdarr,goods_num:s.buyNum,spec_key:s.Stringa,cart_type:"normal",prom_id:s.promId,prom_type:s.promType,entrance:t}).then(function(e){var i=e.data;"cart"==t&&(0==i.error&&(s.getList(),s.buyNum=1,s.popupVisible=!1,document.getElementById("outer").style.height="",s.goodsNum=e.data.data.total_count),i.error)}).catch(function(t){})},getList:function(){this.$axios({method:"get",url:this.$store.state.api.shopcart.get_cart_list,params:{cart_type:"normal"}}).then(function(t){t.data.error}).catch(function(t){})},toGoodsDetail:function(t){this.$router.push({path:"/goodsdetail",query:{id:t.goods_id}})}}},o={render:function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{class:t.goodslist.length?"":"heights"},[t.empty?i("div",{staticClass:"mjsactivity_background"},[i("div",{staticClass:"mjsactivity_div"},[i("div",{staticClass:"activity"},[t._v("活动："+t._s(t.Titles))]),t._v(" "),i("div",{staticClass:"activity_date"},[t._v("活动时间："+t._s(t.activitydate.start_at)+"至"+t._s(t.activitydate.end_at))]),t._v(" "),i("div",{staticClass:"background_div"})])]):t._e(),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.empty,expression:"!empty"}],staticClass:"mjsactivity"},[i("div",{staticClass:"goods-sort"},[i("p",{class:1==t.selected[0].is_selected?"changeClor":"",on:{click:function(s){t.sortType("")}}},[t._v("综合")]),t._v(" "),i("p",{class:1==t.selected[1].is_selected?"changeClor":"",on:{click:function(s){t.sortType("sales_sum")}}},[t._v("销量")]),t._v(" "),i("p",{class:1==t.selected[2].is_selected?"changeClor":"",on:{click:function(s){t.sortType("price")}}},[t._v("价格\n\t\t\t\t"),i("span",{directives:[{name:"show",rawName:"v-show",value:t.priceImg,expression:"priceImg"}]},[i("img",{directives:[{name:"show",rawName:"v-show",value:1==t.priceSort,expression:"priceSort == 1"}],attrs:{src:e("v77k")}}),t._v(" "),i("img",{directives:[{name:"show",rawName:"v-show",value:0==t.priceSort,expression:"priceSort == 0"}],attrs:{src:e("v77k")}})]),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:!t.priceImg,expression:"!priceImg"}],staticClass:"iconfont icon-paixu",staticStyle:{"font-size":"0.2rem",color:"#c1c1c1"}})])]),t._v(" "),i("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.loadMore,expression:"loadMore"}],staticClass:"goodsContent_class"},[i("div",{class:t.promTitle.length>=22?"goodsContent_double":"goodsContent_title",staticStyle:{"margin-top":"0.78rem"},attrs:{id:"scrollobj"}},[i("div",{staticClass:"goodsContent_double_promTitle"},[t._v(t._s(t.promTitle))])]),t._v(" "),i("div",t._l(t.goodslist,function(s){return i("div",{staticClass:"goods"},[i("div",{staticClass:"goods_info"},[i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:s.image,expression:"data.image"}],on:{click:function(e){t.toGoodsDetail(s)}}})]),t._v(" "),i("div",{staticClass:"goods_title"},[t._v("\n\t\t\t\t\t\t"+t._s(s.goods_name)+"\n\t\t\t\t\t")]),t._v(" "),i("div",{staticClass:"goods_price"},[i("span",[t._v("¥ "+t._s(s.price))]),t._v(" "),i("span",{on:{click:function(e){t.getspecs(s)}}},[t._v("加入购物车")])])])}))]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.loadBottom,expression:"loadBottom"}],staticClass:"load-bottom",staticStyle:{position:"relative",width:"100%"}},[i("mt-spinner",{staticStyle:{position:"absolute",top:"0.2rem",left:"38%"},attrs:{type:"fading-circle"}}),t._v(" "),i("span",{staticStyle:{position:"absolute",top:"0rem",left:"47%",color:"#8E8E8E"}},[t._v("加载中...")])],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.notMore,expression:"notMore"}],staticStyle:{width:"100%",heigth:"1rem","line-height":"1rem","text-align":"center",color:"#ccc","font-size":"0.3rem"}},[t._v("\n\t\t\t\t\t没有更多商品了\n\t\t")]),t._v(" "),i("mt-popup",{staticClass:"popup",attrs:{position:"bottom",closeOnClickModal:""},model:{value:t.popupVisible,callback:function(s){t.popupVisible=s},expression:"popupVisible"}},[i("div",{staticClass:"dialog"},[i("i",{staticClass:"iconfont close",on:{click:function(s){t.close()}}},[t._v("")]),t._v(" "),i("div",{staticClass:"dialog-top"},[i("img",{attrs:{src:t.dialogimg}}),t._v(" "),i("div",[i("p",[t._v(t._s(t.goodsName))]),t._v(" "),i("p",[t._v("价格: ￥"+t._s(t.goodsPrice))]),t._v(" "),i("p",[t._v(t._s(t.goodsSpec))])])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.haveSpec,expression:"haveSpec"}],staticClass:"spec"},t._l(t.specgrouplist,function(s,e){return i("div",{key:"index2",staticClass:"spec-group"},[i("div",{staticClass:"spec-label"},[t._v(t._s(s.label))]),t._v(" "),i("div",{staticClass:"spec-detail"},t._l(s.items,function(s,o){return i("div",{key:"index1",class:[1==s.select?"is-select":""],on:{click:function(i){t.getItemsId(s,o,e)}}},[t._v(t._s(s.item))])}))])})),t._v(" "),i("div",{staticClass:"change"},[i("p",[t._v("请选择购买的数量")]),t._v(" "),i("div",[i("span",{class:[1==t.buyNum?"can-not":""],on:{click:function(s){return s.stopPropagation(),s.preventDefault(),t.miusCount(s)}}},[t._v("-")]),t._v(" "),i("span",[t._v(t._s(t.buyNum))]),t._v(" "),i("span",{on:{click:function(s){return s.stopPropagation(),s.preventDefault(),t.addCount(s)}}},[t._v("+")])])]),t._v(" "),i("div",{staticClass:"popup-btn"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.showAddShopping,expression:"showAddShopping"}],staticClass:"init-add",attrs:{id:"popup_add"},on:{click:function(s){t.addorgoShopping("cart")}}},[t._v("加入购物车")])])])])],1)])},staticRenderFns:[]};var a=e("VU/8")(i,o,!1,function(t){e("X/JS")},"data-v-56094dc3",null);s.default=a.exports},v77k:function(t,s){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAAXCAYAAADpwXTaAAAAAXNSR0IArs4c6QAAAfhJREFUOBHllD1IQlEUx++9WuYHKARFQVtrtEREU0sZZVGDb7EQIbCpIaIaW4taggojSIkWHYIUIwhqqIZwKtqaXKJJhSQi9PY/j568Zy+xj60D9517vn7vXO4HYzVESsnz+fxqLpd7LhQKGzVSa4cAEgDtAiS1AXuHfvBVpWkABRYURlE0VV3IOd9zu91h6PKnWLUDoAYs6RDaXx3T2QcejycEYEnnY4bOALChozgSxvVJZnOAEugwAP2mxSswgOzo6AjaqwXr0El06AfwlXJVGAAugJLQA3UADCkAnaHDCegiB8CNpaWR0W/I+p5xhQ5H6Ryd/6Qjk39dWuE8wcgKIcqA0u7QlqsDNukSxcj3Yas+vU1xyC18/0F4MrYwzyTv/oPF3ltxb/1Myr7fwnDOzoXdIYZxcq9/A6P6JoeYFIPKaqHR0jpEJ/knQM7Zhcvp8hKncjfT6U1b6SmbkIyN1QtF8Wmzs32yX5l/oZoKjIxMJtLwePdwKFnN54dSGVZybGnpUEZG5tRLrvrUiO4j43FL6uVmH2d/Wuc2TDnjibauzkBPT7jy/FCCoTOtQsoVkYoVI7g+M5pP01ywA5+9N8QVxfAwUtwURgGAeCq2uA09SzYJlrbnCzrxZK/Q/fwkX8IoUwVGl9YZL4eB2vIF15YBxB6Zyzts5eD+AEuo1AAAAABJRU5ErkJggg=="}});